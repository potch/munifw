const t="value",e=t=>null!==t&&"object"==typeof t,n=(t,e)=>[...t].map(e);export const isSignal=n=>e(n)&&t in n;export const using=(t,e)=>{try{e()}finally{t()}};export const collect=(t,e,n=[])=>(using(t(t=>n.push(t)),e),n);export const event=(t=new Set)=>[(...e)=>n(t,t=>t(...e)),e=>(t.add(e),()=>t.delete(e))];const o=[],r=new Set;let c=0;export const signal=(e,n=(t,e)=>t===e)=>{const[r,c]=event();return{set[t](t){n(e,t)||(e=t,r())},touch(){r()},get[t](){return o.at(-1)&&o.at(-1).add(this),e},peek:()=>e,watch:c}};export const[emitEffect,onEffect]=event();export const effect=(t,...e)=>{let s=0;o.push(new Set(e));const a=()=>{if(c>0)return r.add(a);if(!s){s=1;try{t((...t)=>emitEffect(effect(...t)))}finally{s=0}}};let f;try{a(),f=n(o.at(-1),t=>t.watch(a))}finally{o.pop()}return()=>n(f,t=>t())};export const computed=(e,...n)=>{const o=signal();return o.teardown=effect(()=>o[t]=e(o[t]),...n),emitEffect(o.teardown),o};export const batch=t=>{c++;try{t()}finally{0===--c&&(n(r,t=>t()),r.clear())}};export const setProp=(n,o,r)=>{var c;"ref"==o&&t in r?r[t]=n:e(c=r)&&t in c?emitEffect(effect(()=>setProp(n,o,r[t]))):"function"==typeof r||e(r)||o in n?n[o]&&e(n[o])?assign(n[o],r):n[o]=null===r?"":r:null!==r&&(0!=r||o.startsWith("data-")||o.startsWith("aria-"))?n.setAttribute(o,r):n.removeAttribute(o)};export const assign=(t,n)=>(n&&Object.entries(n).forEach(([n,o])=>{t.nodeType?setProp(t,n,o):e(t[n])&&e(o)?assign(t[n],o):t[n]=o}),t);export const dom=(t,n,...o)=>{let r;return"function"==typeof t?r=mount(()=>t(n,o)):(r=document.createElement(t),n&&e(n)&&!n.nodeType?assign(r,n):n&&o.unshift(n),r.append(...o.flat(1))),r};export const mount=(t,...e)=>{const n=[];let o;return emitEffect(effect(()=>{for(;n.length;)try{n.pop()()}catch(t){}collect(onEffect,()=>{const e=t()??document.createComment("");o&&o.replaceWith(e),o=e},n)},...e)),o};export const on=(t,...e)=>(t.addEventListener(...e),()=>t.removeEventListener(...e));
